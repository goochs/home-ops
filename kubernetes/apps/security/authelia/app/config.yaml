---
access_control:
  default_policy: deny
  rules:
    - domain: '*.serek.xyz'
      policy: one_factor
      subject:
        - group:sso
authentication_backend:
  ldap:
    address: ldap://lldap.security.svc.cluster.local:389
    base_dn: dc=serek,dc=xyz
    implementation: lldap
    user: uid=authelia,ou=people,dc=serek,dc=xyz
    users_filter: (&({username_attribute}={input})(objectClass=person))
  refresh_interval: 1m
identity_providers:
  oidc:
    clients:
      - authorization_policy: one_factor
        client_id: '{{ env "IMMICH_ID" }}'
        client_name: Immich
        client_secret: '{{ env "IMMICH_HASH" }}'
        public: false
        redirect_uris:
          - https://immich.serek.xyz/auth/login
          - https://immich.serek.xyz/user-settings
          - app.immich:///oauth-callback
        scopes:
          - openid
          - profile
          - email
        token_endpoint_auth_method: client_secret_post
        userinfo_signed_response_alg: none
      - authorization_policy: one_factor
        client_id: '{{ env "MINIO_ID" }}'
        client_name: Minio
        client_secret: '{{ env "MINIO_HASH" }}'
        pre_configured_consent_duration: 1w
        public: false
        redirect_uris:
          - https://minio.serek.xyz/oauth_callback
        scopes:
          - openid
          - profile
          - email
          - groups
        token_endpoint_auth_method: client_secret_basic
        userinfo_signed_response_alg: none
    cors:
      allowed_origins_from_client_redirect_uris: true
      endpoints: ["authorization", "token", "revocation", "introspection"]
notifier:
  disable_startup_check: true
  smtp:
    address: submissions://smtp.mail.me.com:587
    sender: Authelia <authelia@serek.xyz>
session:
  cookies:
    - authelia_url: https://sso.serek.xyz
      domain: serek.xyz
      name: serek_session
  redis:
    host: authelia-dragonfly.security.svc.cluster.local
